<html>
<head>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.0.8.js"></script>
    <style type="text/css">
        .hbox {
            display: -webkit-flex;
            display: flex;
            -webkit-flex-direction: row;
            flex-direction: row;
            width: 50em;
        }
        .grow {  flex: 1;   }
        textarea { height: 30em; }
    </style>
<body>
<div class='hbox'>
    <textarea id='history' class='grow'></textarea>
</div>
<div class='hbox'>
    <input id='message' class='grow'/>
    <button id='send'>Send</button>
</div>
<div class="hbox">
    <button id="french-joke">Tell me a joke [fr]</button>
</div>
<script type="text/javascript">
    // a simple JQuery like function to get elements by ID
    function $(id) {
        return document.getElementById(id);
    }

    //configure pubnub
    var pubnub = new PubNub({
        subscribeKey:"sub-c-b89ea32a-79f1-11e6-9195-02ee2ddab7fe",
        publishKey:"pub-c-91ff2cc0-42ff-4783-abfd-e6283ff5348b"
    });
    //when message comes in
    pubnub.addListener({
        message: function(msg) {
            var res = msg.message.response;
            console.log("got back the message",msg.message);
            $('history').value += res + '\n';
        }
    });
    //listen to the 'radchat' channel
    pubnub.subscribe({channels:['chatbot-response']});
    //which click the send button
    $('send').addEventListener('click',sendChat);
    function sendChat() {
        var val = $('message').value;
        $('history').value += val + '\n';
        //send the message
        pubnub.publish({
            channel:'chatbot',
            message:{text: val}
        });
        $('message').value = '';
        $('message').focus();
    };
    $('message').addEventListener('keypress',function(e) {
        if(e.keyCode == 13) sendChat();
    });

    $('french-joke').addEventListener('click',function() {
        $('message').value = 'Raconte moi une blague';
        $('message').focus();
    })

</script>
</body>
</html>